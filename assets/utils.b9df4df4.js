import{d as e,aa as t,O as i,j as a,m as o,a as s,o as r,c as n,w as d,u as l,n as h,e as u,g as c,i as m,b as g,A as y,l as p,p as w,f,v,ab as b,ac as E,ad as k,ae as S,af as L}from"./index-a22744b0.js";import{_ as $}from"./u-icon.5347731a.js";import{_}from"./errorImg.f06d5c36.js";const C={props:{show:{type:Boolean,default:()=>e.transition.show},mode:{type:String,default:()=>e.transition.mode},duration:{type:[String,Number],default:()=>e.transition.duration},timingFunction:{type:String,default:()=>e.transition.timingFunction}}},U=e=>({enter:`u-${e}-enter u-${e}-enter-active`,"enter-to":`u-${e}-enter-to u-${e}-enter-active`,leave:`u-${e}-leave u-${e}-leave-active`,"leave-to":`u-${e}-leave-to u-${e}-leave-active`}),B={methods:{clickHandler(){this.$emit("click")},async vueEnter(){const e=U(this.mode);this.status="enter",this.$emit("beforeEnter"),this.inited=!0,this.display=!0,this.classes=e.enter,await t(),await i(20),this.$emit("enter"),this.transitionEnded=!1,this.$emit("afterEnter"),this.classes=e["enter-to"]},async vueLeave(){if(!this.display)return;const e=U(this.mode);this.status="leave",this.$emit("beforeLeave"),this.classes=e.leave,await t(),this.transitionEnded=!1,this.$emit("leave"),setTimeout(this.onTransitionEnd,this.duration),this.classes=e["leave-to"]},onTransitionEnd(){this.transitionEnded||(this.transitionEnded=!0,this.$emit("leave"===this.status?"afterLeave":"afterEnter"),!this.show&&this.display&&(this.display=!1,this.inited=!1))}}};const T=_({name:"u-transition",data:()=>({inited:!1,viewStyle:{},status:"",transitionEnded:!1,display:!1,classes:""}),emits:["click","beforeEnter","enter","afterEnter","beforeLeave","leave","afterLeave"],computed:{mergeStyle(){const{viewStyle:e,customStyle:t}=this;return{transitionDuration:`${this.duration}ms`,transitionTimingFunction:this.timingFunction,...a(t),...e}}},mixins:[o,s,B,C],watch:{show:{handler(e){e?this.vueEnter():this.vueLeave()},immediate:!0}}},[["render",function(e,t,i,a,o,s){const g=m;return o.inited?(r(),n(g,{key:0,class:h(["u-transition",o.classes]),ref:"u-transition",onClick:e.clickHandler,style:u([s.mergeStyle]),onTouchmove:e.noop},{default:d((()=>[l(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick","class","style","onTouchmove"])):c("",!0)}],["__scopeId","data-v-6a21edd6"]]);const I=_({name:"u-image",mixins:[o,s,{props:{src:{type:String,default:()=>e.image.src},mode:{type:String,default:()=>e.image.mode},width:{type:[String,Number],default:()=>e.image.width},height:{type:[String,Number],default:()=>e.image.height},shape:{type:String,default:()=>e.image.shape},radius:{type:[String,Number],default:()=>e.image.radius},lazyLoad:{type:Boolean,default:()=>e.image.lazyLoad},showMenuByLongpress:{type:Boolean,default:()=>e.image.showMenuByLongpress},loadingIcon:{type:String,default:()=>e.image.loadingIcon},errorIcon:{type:String,default:()=>e.image.errorIcon},showLoading:{type:Boolean,default:()=>e.image.showLoading},showError:{type:Boolean,default:()=>e.image.showError},fade:{type:Boolean,default:()=>e.image.fade},webp:{type:Boolean,default:()=>e.image.webp},duration:{type:[String,Number],default:()=>e.image.duration},bgColor:{type:String,default:()=>e.image.bgColor}}}],data(){return{isError:!1,loading:!0,opacity:1,durationTime:this.duration,backgroundStyle:{},show:!1}},watch:{src:{immediate:!0,handler(e){e?(this.isError=!1,this.loading=!0):this.isError=!0}}},computed:{wrapStyle(){let e={};return e.width=g(this.width),e.height=g(this.height),e.borderRadius="circle"==this.shape?"10000px":g(this.radius),e.overflow=this.radius>0?"hidden":"visible",y(e,a(this.customStyle))}},mounted(){this.show=!0},emits:["click","error","load"],methods:{addUnit:g,onClick(){this.$emit("click")},onErrorHandler(e){this.loading=!1,this.isError=!0,this.$emit("error",e)},onLoadHandler(e){this.loading=!1,this.isError=!1,this.$emit("load",e),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}}}},[["render",function(e,t,i,a,o,s){const h=v,g=p(w("u-icon"),$),y=m,b=p(w("u-transition"),T);return r(),n(b,{mode:"fade",show:o.show,duration:e.fade?1e3:0},{default:d((()=>[f(y,{class:"u-image",onClick:s.onClick,style:u([s.wrapStyle,o.backgroundStyle])},{default:d((()=>[o.isError?c("",!0):(r(),n(h,{key:0,src:e.src,mode:e.mode,onError:s.onErrorHandler,onLoad:s.onLoadHandler,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"u-image__image",style:u({borderRadius:"circle"==e.shape?"10000px":s.addUnit(e.radius),width:s.addUnit(e.width),height:s.addUnit(e.height)})},null,8,["src","mode","onError","onLoad","show-menu-by-longpress","lazy-load","style"])),e.showLoading&&o.loading?(r(),n(y,{key:1,class:"u-image__loading",style:u({borderRadius:"circle"==e.shape?"50%":s.addUnit(e.radius),backgroundColor:this.bgColor,width:s.addUnit(e.width),height:s.addUnit(e.height)})},{default:d((()=>[l(e.$slots,"loading",{},(()=>[f(g,{name:e.loadingIcon,width:e.width,height:e.height},null,8,["name","width","height"])]),!0)])),_:3},8,["style"])):c("",!0),e.showError&&o.isError&&!o.loading?(r(),n(y,{key:2,class:"u-image__error",style:u({borderRadius:"circle"==e.shape?"50%":s.addUnit(e.radius),width:s.addUnit(e.width),height:s.addUnit(e.height)})},{default:d((()=>[l(e.$slots,"error",{},(()=>[f(g,{name:e.errorIcon,width:e.width,height:e.height},null,8,["name","width","height"])]),!0)])),_:3},8,["style"])):c("",!0)])),_:3},8,["onClick","style"])])),_:3},8,["show","duration"])}],["__scopeId","data-v-febc2405"]]);async function R(e){const{url:t,filename:i="image.png"}=e;await b({type:"loading",title:"正在预加载..."});try{const e=new AbortController,a=await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"}});if(!a.ok)throw new Error(`Failed to download image: ${a.status}`);const o=await a.blob(),s=window.URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=i,r.click(),e.abort(),E(),window.URL.revokeObjectURL(s)}catch(a){E(),await k({title:"操作太快了,请稍微休息一下",icon:"none"})}}async function j(e){let t=await S({url:e,method:"GET",responseType:"arraybuffer"}),i=L(t.data);return i&&(i="data:image/jpeg;base64,"+i),i}export{I as _,R as d,j as g};
